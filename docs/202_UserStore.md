# MuFo Document : UserStore仕様

## 概要

UserStoreはログインユーザに関連するデータを管理します。

## プロパティ

ストアのプロパティは全て参照専用です。
参照型(オブジェクト)の中身を変更してもデータは反映されません。

### {string} uid 自身のUID

自分自身のユーザIDです。未ログイン状態ではnullになります。
UIDを取得する方法はいくつかあります。下記は全て同じ意味です。

**例**

```javascript
// 下記は全て同じ意味です
let myUid;
myUid = App.uid;
myUid = App.stores.userStore.uid;
myUid = App.stores.userStore.currentUser.uid;
```

### {UserModel} currentUser 自身の情報

ログインユーザ(自分自身)の情報です。
未ログイン状態ではnullです。
取得できる情報の詳細はUserModelの定義を参照してください。


## アクション

### USER_LOGIN ログインする

ログインします。未ログイン状態でこのアクションを呼び出すと、SNSログインの画面に遷移し、認証/認可が行われます。この遷移はMuFoアプリ外への移動のため、アプリ内の途中状態はこの時点で全て破棄されることに留意してください。
認証が完了すると、認証要求時点で表示されていたMuFoのURLが再度読み込まれ、続けて`USER_LOGGEDIN`イベントが発行されます。

初回認証後はログアウトするまで認証済状態が継続します。したがって、ログアウトせずにブラウザを閉じた場合、次回MuFoを開くと直後に`USER_LOGGEDIN`が発行されて自動的にログイン状態となります。

**引数**

|  名前  |  型  |  必須?  |  説明  |
| --- | --- | --- | --- |
|  sns  |  string  |  N  |  ログインに使用するSNSを指定します。`google`,`facebook`,`twitter`のいずれかを指定して下さい。省略した場合、現在のログイン状態を確認し、ログイン済であれば`USER_LOGGEDIN`イベントを発行する処理を行います(この処理は起動時に自動的に実行されるため、画面側から明示的に呼び出す必要は基本的にありません)  |


### USER_LOGOUT ログアウトする

ログアウトします。即座に`USER_LOGGEDOUT`イベントを発行します。

**引数**

|  名前  |  型  |  必須?  |  説明  |
| --- | --- | --- | --- |


### USER_CHANGE_PROFILE プロフィールを変更する

ユーザのプロフィール(名前・アバター・チュートリアルクリアの有無、等)を変更します。ログイン済でないと使えません。

**引数**

|  名前  |  型  |  必須?  |  説明  |
| --- | --- | --- | --- |
|  user  |  UserModel  |  Y  |  変更するユーザ情報  |
|  fields  |  Array[string]  |  Y  |  更新するフィールド(プロパティ)の名前  |

更新する際にはUserModelと合わせて更新対象のプロパティを明示する必要があります。例を参照して下さい。

**例**

```javascript
// 名前とアバターを変更します
const user1 = App.stores.userStore.currentUser;
user1.name = 'MuFo1号';
user1.avatar = '1,2,3,4';
App.trigger(App.actions.USER_CHANGE_PROFILE, user1, ['name','avatar']);

// 更新元のユーザ情報は以下のように新規のUserModelインスタンスでも構いません(どちらも同じです)
const user2 = new App.models.UserModel();
```

UserModelのプロパティの詳細は、ドキュメントまたはUserModelの定義を参照して下さい。


## イベント

### USER_LOGGEDIN ログインが完了した

ログインが完了した際に発行されるイベントです。ログインフローの詳細は`USER_LOGIN`アクションの説明を参照して下さい。

**コールバックの引数**

|  名前  |  型  |  説明  |
| --- | --- | --- |


### USER_LOGOUT ログアウトした

ログアウト時に発行されます。

**コールバックの引数**

|  名前  |  型  |  説明  |
| --- | --- | --- |

### USER_PROFILE_CHANGED プロフィールが変更された

自身のプロフィール情報に変化があった時に通知されるイベントです。`USER_CHANGE_PROFILE`アクションを発行した時以外にもログイン完了時・ログアウト時にもこのイベントが発行されます。
変更後のプロフィールは`currentUser`プロパティで取得して下さい。

**コールバックの引数**

|  名前  |  型  |  説明  |
| --- | --- | --- |
